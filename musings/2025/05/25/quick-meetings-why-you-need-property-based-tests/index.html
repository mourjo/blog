<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="shortcut icon" href="/blog/favicon.png"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lora:ital,wght@0,400..700;1,400..700&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet"> <script src="/blog/js/search.js"> </script> <meta name="robots" content="index,noarchive,follow,max-image-preview:large"> <title>Quick Meetings: Why You Need Property Based Tests | Mourjo Sen</title> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script> <script> hljs.highlightAll(); </script> <meta property="og:site_name" content="Mourjo Sen's Blog"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2025-05-25 09:04:24 +0200"> <meta name="title" content="Quick Meetings: Why You Need Property Based Tests"> <meta property="og:title" content="Quick Meetings: Why You Need Property Based Tests"> <meta name="description" content="Today I am open-sourcing my quick-meetings repository. It has one aim - to show the importance of property based testing (or generative testing)."> <meta property="og:description" content="Today I am open-sourcing my quick-meetings repository. It has one aim - to show the importance of property based testing (or generative testing)."> <meta property="og:url" content="https://mourjo.me/blog/musings/2025/05/25/quick-meetings-why-you-need-property-based-tests/"> <meta property="al:web:url" content="https://mourjo.me/blog/musings/2025/05/25/quick-meetings-why-you-need-property-based-tests/"> <meta property="og:image" content="https://mourjo.me/resources/images/card.jpg"> <meta property="article:author" content="https://mourjo.me"> <meta name="author" content="Mourjo Sen"> <meta property="twitter:title" content="Quick Meetings: Why You Need Property Based Tests"> <meta name="twitter:site" content="@mourjo_sen"> <meta property="twitter:description" content="Today I am open-sourcing my quick-meetings repository. It has one aim - to show the importance of property based testing (or generative testing)."> <meta name="twitter:image:src" content="https://mourjo.me/resources/images/card.jpg"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:creator" content="@mourjo_sen"> <meta name="twitter:label1" content="Reading time"> <meta name="twitter:data1" content="5 min read"> <!-- Google tag (gtag.js) --> <script> // Only load on production environment. if (window.location.host !== 'mourjo.me') { window.goatcounter = {no_onload: true} } </script> <script data-goatcounter="https://stats.mourjo.me/count" async src="//stats.mourjo.me/count.js"></script> <link rel="stylesheet" href="/blog/css/sketch.css"> </script> </head> <body> <div class="page"> <div> <div class="header"> <a class="brand" href="https://mourjo.me/">Mourjo Sen</a> <a href="/blog/">Blog</a> &#124; <a href="/cv">CV</a> </div> </div> <div class="post"> <div class="searchbar-container"> <div class="search-container" id="search-container"> <input type="text" id="search-bar" class="search-bar" placeholder="üîç Search"> <div class="search-results-container" id="search-results"></div> </div> </div> <main> <article> <script src="https://giscus.app/client.js" data-repo="mourjo/blog" data-repo-id="MDEwOlJlcG9zaXRvcnk2ODE2OTIzNQ==" data-category="General" data-category-id="DIC_kwDOBBAuE84Cmw3O" data-mapping="og:title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async> </script> <h1 class="post-headline">Quick Meetings: Why You Need Property Based Tests</h1> <p class="copy"> May 25, 2025 </p> <p>Today I am open-sourcing my <a href="https://github.com/mourjo/quick-meetings">quick-meetings</a> repository. It has one aim - to show the importance of property based testing (or generative testing).</p> <p>At its core, this project allows you to create meetings. It is a very simple application. What could possibly go wrong?</p> <p><img src="/blog/images/2025-05-25-quick-meetings-why-you-need-property-based-tests-1.png" alt="Image Description" /></p> <h2 id="bug-1-non-json-response-body">Bug 1: Non-JSON response body</h2> <p>If the accept header is something like¬†<code>text/html</code>, Spring will try to return an HTML page, which is not what we want from an API - causing errors like this for the client:</p><pre><code>com.fasterxml.jackson.core.JsonParseException:
  Unexpected character ('&lt;' (code 60)): expected a valid value (JSON String, Number, Array, Object or token 'null', 'true' or 'false')
  at [Source: (String)"&lt;html&gt;&lt;body&gt;&lt;h1&gt;Whitelabel Error Page&lt;/h1&gt;&lt;p&gt;This application has no explicit mapping for /error, so you are seeing this as a fallback.&lt;/p&gt;&lt;div id='created'&gt;Sat May 24 14:11:11 CEST 2025&lt;/div&gt;&lt;div&gt;There was an unexpected error (type=Method Not Allowed, status=405).&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;"; line: 1, column: 1]
</code></pre><p>Check out this <a href="https://github.com/mourjo/quick-meetings/tree/demo-1-server-never-returns-5xx">branch</a> on how this was detected with property based testing.</p> <h2 id="bug-2-nullpointers-and-5xx">Bug 2: NullPointers and 5xx</h2> <p>Your code should never return a 5xx for any kind of request - a catch-all response code like 5xx should only be reserved for infrastructure issues what you genuinely cannot predict.</p> <p>But if you send a payload like this, the response will be ‚Äì quite sadly ‚Äì a 5xx:</p><pre><code>curl -X 'POST' 'http://localhost:9981/meeting' -s \
  -H 'Content-Type: application/json' \
  -d '{
  "userId": 260754,
  "name": "Bobby'\''s meeting"
}' | jq .

{
  "timestamp": "2025-05-25T07:14:37.890+00:00",
  "status": 500,
  "error": "Internal Server Error",
  "trace": "java.lang.NullPointerException: Cannot invoke \"me.mourjo.quickmeetings.web.dto.MeetingDuration.from()\" because..."
}
</code></pre><p>Check out this <a href="https://github.com/mourjo/quick-meetings/tree/demo-1-server-never-returns-5xx">branch</a> on how property based tests found and resolved this bug.</p> <h2 id="bug-3-gap-in-daylight-savings">Bug 3: Gap in Daylight Savings</h2> <p>In the following snippet, a meeting creation request specifies the start-time at¬†<strong>02:34</strong>¬†and end-time at¬†<strong>03:04</strong>, the error thrown says the start time is after the end time.</p><pre><code>Original Sample
---------------
  meetingArgs:
    MeetingArgs[fromDate=2025-03-30, fromTime=02:34:31, toDate=2025-03-30, toTime=03:04:31, timezone=Europe/Amsterdam]

  Original Error
  --------------
  java.lang.AssertionError:
    Expecting actual:
      "{"message":"Meeting cannot start (2025-03-30T03:34:31+02:00[Europe/Amsterdam]) after its end time (2025-03-30T03:04:31+02:00[Europe/Amsterdam])"}"
    to contain at least one of the following elements:
      ["Meeting created"]
    but none were found
</code></pre><p>This happens when the start or end time falls in a local timezone which is a ‚Äúgap‚Äù due to daylight savings. On 30 March 2025, at¬†<code>02:00:00</code>¬†clocks in France were turned forward 1 hour to¬†<code>03:00:00</code>¬†- the time between 2 and 3 does not exist and is a gap.</p> <p>This is caught again by property-based tests in <a href="https://github.com/mourjo/quick-meetings/tree/demo-2-invalid-date-range">this branch</a>.</p> <h2 id="bug-4-query-to-check-overlapping-meetings">Bug 4: Query to check overlapping meetings</h2> <p>The following query has a bug - it is quite hard to catch it at first glance (<code>$1</code> and <code>$2</code> are placeholders for the start and end time of a new meeting being created):</p><pre><code class="language-sql">SELECT *
FROM
meetings existing_meeting JOIN user_meetings um ON existing_meeting.id = um.meeting_id
WHERE (
  (existing_meeting.from_ts &lt;= $1 AND existing_meeting.to_ts &gt;= $1)
  OR
  (existing_meeting.from_ts &lt;= $2 AND existing_meeting.to_ts &gt;= $2)
)
</code></pre><p>Property based tests in <a href="https://github.com/mourjo/quick-meetings/tree/demo-3-meeting-creation-scenarios">this branch</a> reports the minimal case when this happens. This test fails when the second meeting is overlapping with the first but only if the second meeting¬†<strong>starts before</strong>and¬†<strong>ends after</strong>¬†the first - note how the original sample finds a larger time overlap but the shrunk example finds the smallest failing case:</p><pre><code>Shrunk Sample (130 steps)
-------------------------
  meeting1Start: 2025-01-01T10:00:01
  meeting1DurationMins: 1
  meeting2Start: 2025-01-01T10:00
  meeting2DurationMins: 2

Original Sample
---------------
  meeting1Start: 2025-01-01T20:09:29
  meeting1DurationMins: 6
  meeting2Start: 2025-01-01T19:55:33
  meeting2DurationMins: 49
</code></pre><h2 id="bug-5-accepting-a-meeting-causes-an-overlap">Bug 5: Accepting a meeting causes an overlap</h2> <p>In the previous bug, the fix ensured that the query to check overlapping meeting is correct but it is still possible to have overlapping meetings - as caught by property based tests in <a href="https://github.com/mourjo/quick-meetings/tree/demo-4-meeting-acceptations">this branch</a>.</p> <p>Complex interleaving of user interactions ‚Äì creating meetings, inviting others to meetings and accepting meeting invites ‚Äì breaks the invariant that no person can be in two meetings at the same time. But which sequence of actions?</p> <p><a href="https://github.com/mourjo/quick-meetings/tree/demo-4-meeting-acceptations">Property based tests</a> find minimal subset of operations that trigger the failure:</p> <ul> <li>Alice and Charlie create overlapping meetings - this is okay because our invariant is no person can be at the same meeting, but if the attendees are different (here Alice and Charlie), it is perfectly fine</li> <li>It is also not a problem when Charlie is invited to Alice‚Äôs meeting</li> <li>It becomes a problem when Charlie accepts that meeting - because it overlaps with the meeting he created</li> <li>This is the minimal set of operations that shows the bug</li> </ul><pre><code>OperationsGenTests.noOperationCausesAnOverlap:63 Invariant failed after the following actions: [
    Inputs{action=CREATE, user=alice, from=2025-06-09T10:21Z, to=2025-06-09T10:22Z}
    Inputs{action=INVITE, user=charlie, meetingIdx=0}
    Inputs{action=CREATE, user=charlie, from=2025-06-09T10:21Z, to=2025-06-09T10:22Z}
    Inputs{action=ACCEPT, user=charlie, meetingIdx=0}
]
</code></pre><p>But there are other more nuanced cases like this which sometimes get reported as well:</p> <ul> <li>Charlie creates a meeting 0</li> <li>Bob is invited to meeting 0</li> <li>Alice creates a meeting 1 (overlapping with meeting 0)</li> <li>Bob is invited to meeting 1</li> <li>Bob accepts the invitation to meeting 0 (still no overlap)</li> <li>Bob accepts the invitation to meeting 1 (this causes an overlap for Bob)</li> </ul><pre><code>OperationsGenTests.noOperationCausesAnOverlap:67 Invariant failed after the following actions: [
    Inputs{action=CREATE, user=charlie, from=2025-06-09T10:21Z, to=2025-06-09T10:22Z}
    Inputs{action=INVITE, user=bob, meetingIdx=0}
    Inputs{action=CREATE, user=alice, from=2025-06-09T10:21Z, to=2025-06-09T10:22Z}
    Inputs{action=INVITE, user=bob, meetingIdx=0}
    Inputs{action=ACCEPT, user=bob, meetingIdx=0}
    Inputs{action=ACCEPT, user=bob, meetingIdx=1}
]
</code></pre><h2 id="bug-6-empty-meetings">Bug 6: Empty meetings</h2> <p>Once we have a way to test interleaving of operations, it is easy to extend that same framework - for example to preserve the invariant of no meeting should be empty.</p> <p>While this seems like a gross miss, when we work on individual features, it is difficult to keep track of the larger product‚Äôs vision or expectations. This branch is the same - once we allow people to reject meeting invites, this bug manifests itself.</p> <p>The minimal set of operations that fail is simple - this is provided by the test output as well:</p> <ul> <li>Alice creates a meeting</li> <li>Alice rejects that same meeting</li> </ul><pre><code>OperationsGenTests.noOperationCausesEmptyMeetings:70 Invariant failed after the following actions: [
    Inputs{action=CREATE, user=alice, from=2025-06-09T10:21Z, to=2025-06-09T10:22Z}
    Inputs{action=REJECT, user=alice, meetingIdx=0}
]
</code></pre><p>Check <a href="https://github.com/mourjo/quick-meetings/tree/demo-5-empty-meetings">this branch</a> for the details.</p> <h2 id="conclusion">Conclusion</h2> <p>Testing invariants is different from example based tests. It requires you to think of what the product you are building <em>should</em> do instead of <em>how</em> it should do it. As we saw above, it is very hard to both build a new feature and ensure there are no obscure bugs (like daylight savings) and that it performs as expected in the face of complex interleaving of actions (like accepting meetings which overlap with existing meetings).</p> <p>Property based testing encourages you to think of your code as a black box of logic - to test its limits with permutations of inputs (both user input and state) - which is simply not possible to enumerate manually.</p> <p>If you like this topic, I am going to be speaking at TechCamp in Hamburg in June - hope to see you there!</p> <p><img src="/blog/images/2025-05-25-quick-meetings-why-you-need-property-based-tests-2.jpeg" alt="Image Description" /></p> <p class="copy"> See anything to improve? <a href="https://github.com/mourjo/blog/tree/master/_posts/2025-05-25-quick-meetings-why-you-need-property-based-tests.md">Edit this post</a>! </p> </article> <div class="giscus"></div> </main> <div class="footer"> <a href="/blog/">Blog</a> &#124; <a href="/cv">CV</a> </div> </div> </div> </body> </html>
